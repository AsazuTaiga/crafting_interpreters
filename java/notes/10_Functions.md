# 10. Functions

これまで作成してきた、式、文、変数、制御フロー、字句スコープにさらにいくつかのパーツを追加し、ユーザー定義関数と関数呼び出しをサポートする。

## 関数呼び出し

- 通常、呼び出しは名前付き関数に対して行われる
  - ex. `average(1,2);` 
- 呼び出される対象（呼び出し先）は関数として評価される任意の式にすることができる
  - ex. `getCallback()()`
  - 呼び出しは、`(`で始まる後置演算子のようなものとして考えることができる
  - この「演算子」は、他のどの演算子よりも優先される
- unary にルールを追加する
- BNF
  ```
  unary     -> ( "!" | "-" ) unary | call ;
  call      -> primary ( "(" arguments? ")" )* ;
  ```
  - `*` は`fn(1)(2)(3)`みたいなカリー化された関数をサポートするためにあるっぽい
- 引数リストBNF
  ```
  arguments -> expression ( "," expression )* ; 
  ```
- GenerateAst.javaにノードを追加する(`Call`)
- Parser.javaの処理を変更
  - `binary()`
    - `unary()`にジャンプしていたのを`call()`へのジャンプに修正
  - `call()`
    - まず一次式=呼び出しの「左オペランド」を`primary()`で解析
    - 次に、`(`が表示されるたびに`finishCall()`ヘルパーで、現在のパース結果をもとにさらに関数呼び出しとして解析
      - `(`がなくなったらbreakしてパース結果を返す
  - `finishCall()`
    - `)`が見つかるまで、カンマ区切りで`expression()`して引数リストに突っ込む
    - `Expr.Call`を作って返却（ASTノードにラップ）

### 最大引数数
- 第3章のバイトコード・インタープリタを見据えた共通仕様として、引数の最大数を255に制限する
  - Parser.java で処理を追加（ただし、エラーを報告するだけでスローしない）
